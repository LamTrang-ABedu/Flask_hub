{% extends "index.html" %}
{% block title %}Universal Media Downloader{% endblock %}
{% block content %}
<h2>Universal Media Downloader</h2>
<div style="margin-bottom: 20px; display: flex; gap: 10px;">
  <input type="text" id="urlInput" placeholder="Paste media URL from X, TikTok, Facebook..." style="flex: 1; padding: 8px;">
  <button onclick="downloadMedia()" style="width: 100px;">Fetch</button>
</div>
<div id="downloadResult" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px;"></div>
<script>
async function downloadMedia() {
  const url = document.getElementById('urlInput').value.trim();
  const container = document.getElementById('downloadResult');
  container.innerHTML = '';
  if (!url) return alert('Please paste a media URL.');
  const res = await fetch(`/api/universal-download?url=${encodeURIComponent(url)}`);
  const data = await res.json();
  if (data.status !== 'ok') {
    container.innerHTML = `<p style="color:red;">Error: ${data.message}</p>`;
    return;
  }
  for (const item of data.media) {
    const card = document.createElement('div');
    card.style = 'border:1px solid #ccc;padding:10px;border-radius:8px;background:#fafafa';
    card.innerHTML = `<p><strong>${item.title || 'Media'}</strong></p>`;
    if (item.ext === 'mp4' || item.url.includes('.mp4')) {
      card.innerHTML += `<video src="${item.url}" controls style="width:100%;margin-top:8px;"></video>`;
    } else {
      card.innerHTML += `<img src="${item.url}" style="width:100%;margin-top:8px;border-radius:4px;">`;
    }
    card.innerHTML += `<a href="${item.url}" download style="display:inline-block;margin-top:10px;color:#007BFF;">Download</a>`;
    container.appendChild(card);
  }
}
</script>
{% endblock %}
